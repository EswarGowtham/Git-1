<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        form {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 10px;
        }

        label {
            width: 100px;
            text-align: right;
            margin-right: 10px;
        }

        input {
            width: 150px;
        }

        button {
            margin-left: 10px;
        }

        #error-message {
            color: red;
        }

        #result {
            margin-top: 20px;
        }
    </style>
    <script>
        function updateQuantity(value) {
            var quantityInput = document.getElementById('quantity');
            var quantity = parseInt(quantityInput.value, 10);
            var updatedQuantity = quantity - value;

            if (updatedQuantity < 0) {
                document.getElementById('error-message').innerText = 'Error: Quantity cannot be less than 0.';
                return;
            }

            quantityInput.value = updatedQuantity;
            document.getElementById('error-message').innerText = '';

            // Update displayed details
            var displayedQuantity = document.getElementById('displayed-quantity');
            displayedQuantity.innerText = updatedQuantity;
        }

        function validateQuantity() {
            var quantity = parseInt(document.getElementById('quantity').value, 10);

            if (quantity < 0) {
                document.getElementById('error-message').innerText = 'Error: Quantity cannot be less than 0.';
                return false;
            } else {
                document.getElementById('error-message').innerText = '';
                return true;
            }
        }

        function displayDetails(details) {
            var resultDiv = document.getElementById('result');
            var detailId = 'detail-' + details.name.replace(/\s+/g, '-'); // Generate a unique ID

            resultDiv.innerHTML += `<div id="${detailId}">
                                       <p><strong>Name:</strong> ${details.name} | 
                                       <strong>Description:</strong> ${details.description} | 
                                       <strong>Price:</strong> ${details.price} | 
                                       <strong>Quantity:</strong> <span id="displayed-quantity-${detailId}">${details.quantity}</span> |
                                       <button type="button" onclick="updateQuantity(1)">Buy 1</button>
                                       <button type="button" onclick="updateQuantity(2)">Buy 2</button>
                                       <button type="button" onclick="updateQuantity(3)">Buy 3</button>
                                       <button type="button" onclick="deleteDetails('${detailId}')">Delete</button></p>
                                   </div>`;
        }

        function deleteDetails(detailId) {
            var detailElement = document.getElementById(detailId);
            if (detailElement) {
                detailElement.remove();
            }
        }

        function saveDetails(details) {
            // Load existing details from localStorage
            var storedDetails = localStorage.getItem('productDetails');

            var allDetails = [];
            if (storedDetails) {
                allDetails = JSON.parse(storedDetails);
            }

            // Add the new details to the list
            allDetails.push(details);

            // Save the updated details list in localStorage
            localStorage.setItem('productDetails', JSON.stringify(allDetails));
        }

        function loadDetails() {
            // Load existing details from localStorage
            var storedDetails = localStorage.getItem('productDetails');

            console.log('Stored Details:', storedDetails);  // Check the console

            try {
                // Attempt to parse the stored details
                var allDetails = JSON.parse(storedDetails);

                if (Array.isArray(allDetails)) {
                    // Display all existing details
                    allDetails.forEach(displayDetails);
                } else if (typeof allDetails === 'object' && allDetails !== null) {
                    // Convert object to array and display details
                    var detailsArray = Object.values(allDetails);
                    detailsArray.forEach(displayDetails);
                } else {
                    console.error('Unexpected data type in localStorage:', typeof allDetails);
                }
            } catch (error) {
                console.error('Error parsing stored details:', error);
            }
        }
        function handleSubmit(event) {
            event.preventDefault(); // Prevent the default form submission behavior
            if (validateQuantity()) {
                var name = document.getElementById('name').value;
                var description = document.getElementById('description').value;
                var price = document.getElementById('price').value;
                var quantity = document.getElementById('quantity').value;
        
                var details = {
                    name: name,
                    description: description,
                    price: price,
                    quantity: quantity
                };
        
                // Display and save the new details
                displayDetails(details);
                saveDetails(details);
            }
            return false; // Ensure the form does not actually submit
        }
        function saveDetailsToCrud(details) {
            // Replace 'your-api-endpoint' with the actual endpoint of your CRUD backend
            var apiEndpoint = 'https://crudcrud.com/api/50f04c8f62b341ce84f3f2aacad9f61c/details';
        
            fetch(apiEndpoint, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(details),
            })
            .then(response => response.json())
            .then(data => {
                console.log('Data saved to CRUD:', data);
                // You can add additional logic here if needed
            })
            .catch(error => {
                console.error('Error saving data to CRUD:', error);
            });
        }
        
        // Example of using saveDetailsToCrud
        var details = {
            name: 'Snickers',
            description: 'choco',
            price: '15',
            quantity: '2'
        };
        
        
        
        function displayDetails(details) {
            var resultDiv = document.getElementById('result');
            resultDiv.innerHTML += `<p><strong>Name:</strong> ${details.name} | 
                                   <strong>Description:</strong> ${details.description} | 
                                   <strong>Price:</strong> ${details.price} | 
                                   <strong>Quantity:</strong> <span id="displayed-quantity">${details.quantity}</span> |
                                   <button type="button" onclick="updateQuantity(1)">Buy 1</button>
                                   <button type="button" onclick="updateQuantity(2)">Buy 2</button>
                                   <button type="button" onclick="updateQuantity(3)">Buy 3</button>
                                   <button type="button" onclick="deleteDetails(this)">Delete</button></p>`;
        }
        
        function deleteDetails(button) {
            var detailElement = button.closest('p');
            if (detailElement) {
                detailElement.remove();
            }
        }
        
        saveDetailsToCrud(details);
        // Load existing details on page load
        window.onload = loadDetails;
    </script>
    <title>Product Form</title>
</head>
<body>

    <h1>Product Information</h1>

    <form onsubmit="return handleSubmit(event);">
        <label for="name">Name:</label>
        <input type="text" id="name" name="name" required>

        <label for="description">Description:</label>
        <input type="text" id="description" name="description" required>

        <label for="price">Price:</label>
        <input type="text" id="price" name="price" required>

        <label for="quantity">Quantity:</label>
        <input type="number" id="quantity" name="quantity" min="0" required>

        <button type="submit">Submit</button>
    </form>

    <p id="error-message"></p>

    <div id="result">
        <h2>Details</h2>
        <!-- Details will be displayed here -->
    </div>

</body>
</html>
